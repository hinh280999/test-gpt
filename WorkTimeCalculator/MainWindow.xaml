<Window x:Class="WorkTimeCalculator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewModels="clr-namespace:WorkTimeCalculator.ViewModels"
        xmlns:views="clr-namespace:WorkTimeCalculator.Views"
        xmlns:converters="clr-namespace:WorkTimeCalculator.Converters"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Work Time Calculator"
        Width="1400"
        Height="900"
        Background="{StaticResource BackgroundBrush}"
        d:DataContext="{d:DesignInstance Type=viewModels:MainViewModel}"
        mc:Ignorable="d">
    <Window.Resources>
        <converters:BreakTimeConverter x:Key="BreakTimeConverter" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:ProgressToDashArrayConverter x:Key="ProgressToDashArrayConverter" />
        <converters:AverageHoursConverter x:Key="AverageHoursConverter" />
        <converters:BreakDurationConverter x:Key="BreakDurationConverter" />
        <converters:HoursToStatusColorConverter x:Key="HoursToStatusColorConverter" />
        <converters:HoursToProgressWidthConverter x:Key="HoursToProgressWidthConverter" />
        <converters:StatusIconConverter x:Key="StatusIconConverter" />
        <converters:DateToDayOfWeekConverter x:Key="DateToDayOfWeekConverter" />
    </Window.Resources>
    <Window.DataContext>
        <viewModels:MainViewModel />
    </Window.DataContext>

    <Grid>
        <!-- Main Content -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="64" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- ========================================== -->
            <!-- HEADER -->
            <!-- ========================================== -->
            <Border Grid.Row="0" 
                    Background="{StaticResource SurfaceBrush}" 
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,0,1"
                    Effect="{StaticResource ShadowSm}">
                <Grid Margin="24,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Logo and Title -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="ClockOutline" 
                                                 Width="32" 
                                                 Height="32"
                                                 Foreground="{StaticResource PrimaryBlueBrush}" 
                                                 Margin="0,0,12,0" />
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Work Time Calculator" 
                                       Style="{StaticResource H1Text}" />
                            <TextBlock Text="Plan your day and leave right on time" 
                                       Style="{StaticResource CaptionText}"
                                       Margin="0,2,0,0" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                VerticalAlignment="Center">
                        <Button Style="{StaticResource IconButtonStyle}"
                                Command="{Binding OpenSettingsCommand}"
                                ToolTip="Settings">
                            <materialDesign:PackIcon Kind="Cog" Width="20" Height="20" />
                        </Button>
                        <Button Style="{StaticResource IconButtonStyle}"
                                Command="{Binding ExportCommand}"
                                ToolTip="Export history (Ctrl+E)"
                                Margin="8,0,0,0">
                            <materialDesign:PackIcon Kind="FileExport" Width="20" Height="20" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ========================================== -->
            <!-- MAIN CONTENT AREA -->
            <!-- ========================================== -->
            <Grid Grid.Row="1" Margin="24">
                <TabControl SelectedIndex="{Binding SelectedTabIndex}"
                            Style="{StaticResource ModernTabControl}"
                            BorderThickness="0">
                    
                    <!-- ========================================== -->
                    <!-- TODAY TAB -->
                    <!-- ========================================== -->
                    <TabItem>
                        <ScrollViewer VerticalScrollBarVisibility="Hidden" 
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="0,16,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="0.65*" />
                                    <ColumnDefinition Width="16" />
                                    <ColumnDefinition Width="0.35*" />
                                </Grid.ColumnDefinitions>

                                <!-- LEFT COLUMN -->
                                <StackPanel Grid.Column="0">

                                    <!-- Time Calculator Card -->
                                    <Border Style="{StaticResource CardStyle}">
                                        <StackPanel>
                                            <!-- Card Header -->
                                            <StackPanel Orientation="Horizontal" 
                                                        Margin="0,0,0,16"
                                                        VerticalAlignment="Center">
                                                <materialDesign:PackIcon Kind="ClockOutline" 
                                                                         Width="24" 
                                                                         Height="24"
                                                                         Foreground="{StaticResource PrimaryBlueBrush}"
                                                                         Margin="0,0,12,0"
                                                                         VerticalAlignment="Center" />
                                                <TextBlock Text="Calculate Your End Time" 
                                                           Style="{StaticResource H2Text}"
                                                           VerticalAlignment="Center" />
                                            </StackPanel>

                                            <!-- Start Time -->
                                            <TextBlock Text="Start Time" 
                                                       Style="{StaticResource BodyText}"
                                                       FontWeight="Medium"
                                                       Margin="0,0,0,8" />
                                            <TextBox x:Name="StartTimeTextBox"
                                                     Text="{Binding StartDateTimeText, UpdateSourceTrigger=PropertyChanged}"
                                                     materialDesign:HintAssist.Hint="Time (e.g., 8:00 AM or dd/MM/yyyy 8:00 AM)"
                                                     Margin="0,0,0,12" />

                                            <!-- Quick Action Buttons -->
                                            <StackPanel Orientation="Horizontal"
                                                        HorizontalAlignment="Left"
                                                        Margin="0,0,0,24">
                                                <Button Style="{StaticResource QuickActionButtonStyle}"
                                                        Margin="0,0,8,0"
                                                        VerticalAlignment="Center"
                                                        VerticalContentAlignment="Center"
                                                        Click="SetToday_Click">
                                                    <StackPanel Orientation="Horizontal" 
                                                                VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="CalendarToday" 
                                                                                 Width="16" 
                                                                                 Height="16"
                                                                                 Margin="0,0,6,0"
                                                                                 VerticalAlignment="Center"
                                                                                 Foreground="White" />
                                                        <TextBlock Text="Today" 
                                                                   FontSize="13"
                                                                   VerticalAlignment="Center"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Button>
                                                <Button Style="{StaticResource QuickActionButtonStyle}"
                                                        Margin="0,0,8,0"
                                                        VerticalAlignment="Center"
                                                        VerticalContentAlignment="Center"
                                                        Click="SetNow_Click">
                                                    <StackPanel Orientation="Horizontal"
                                                                VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="Alarm" 
                                                                                 Width="16" 
                                                                                 Height="16"
                                                                                 Margin="0,0,6,0"
                                                                                 VerticalAlignment="Center"
                                                                                 Foreground="White" />
                                                        <TextBlock Text="Now" 
                                                                   FontSize="13"
                                                                   VerticalAlignment="Center"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Button>
                                                <Button Style="{StaticResource QuickActionButtonStyle}"
                                                        VerticalAlignment="Center"
                                                        VerticalContentAlignment="Center"
                                                        Click="SetCustom_Click">
                                                    <StackPanel Orientation="Horizontal"
                                                                VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="Cog" 
                                                                                 Width="16" 
                                                                                 Height="16"
                                                                                 Margin="0,0,6,0"
                                                                                 VerticalAlignment="Center"
                                                                                 Foreground="White" />
                                                        <TextBlock Text="Custom" 
                                                                   FontSize="13"
                                                                   VerticalAlignment="Center"
                                                                   Foreground="White" />
                                                    </StackPanel>
                                                </Button>
                                            </StackPanel>

                                            <!-- Recommended End Time Display -->
                                            <Border Background="#E8F5E9" 
                                                    CornerRadius="8" 
                                                    Padding="24" 
                                                    Margin="0,24,0,0"
                                                    BorderThickness="2"
                                                    BorderBrush="#4CAF50">
                                                <StackPanel>
                                                    <TextBlock Text="Recommended End Time" 
                                                               Style="{StaticResource BodyText}"
                                                               FontWeight="SemiBold"
                                                               Foreground="#2E7D32"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,0,0,12" />
                                                    
                                                    <!-- Large End Time Display -->
                                                    <Border Background="#FFFFFF"
                                                            CornerRadius="8"
                                                            Padding="24,16"
                                                            BorderThickness="1"
                                                            BorderBrush="#4CAF50"
                                                            Margin="0,0,0,16">
                                                        <TextBlock Text="{Binding RecommendedEndTimeDisplay}" 
                                                                   Style="{StaticResource DisplayText}"
                                                                   Foreground="#2E7D32"
                                                                   HorizontalAlignment="Center" />
                                                    </Border>
                                                    
                                                    <TextBlock Text="{Binding RecommendationDetails}" 
                                                               Style="{StaticResource CaptionText}"
                                                               Foreground="#4CAF50"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,0,0,16" />
                                                    
                                                    <!-- Timeline Visualization -->
                                                    <StackPanel Orientation="Horizontal" 
                                                                HorizontalAlignment="Center"
                                                                Margin="0,0,0,16">
                                                        <StackPanel VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding StartTime, StringFormat='{}{0:t}'}" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       HorizontalAlignment="Center" />
                                                            <TextBlock Text="Start" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       FontSize="10"
                                                                       HorizontalAlignment="Center"
                                                                       Margin="0,2,0,0" />
                                                        </StackPanel>
                                                        <Rectangle Width="80" 
                                                                   Height="3" 
                                                                   Fill="#4CAF50" 
                                                                   Margin="12,0"
                                                                   VerticalAlignment="Center"
                                                                   RadiusX="1.5"
                                                                   RadiusY="1.5" />
                                                        <StackPanel VerticalAlignment="Center">
                                                            <TextBlock Text="12:00" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       HorizontalAlignment="Center" />
                                                            <TextBlock Text="Lunch" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       FontSize="10"
                                                                       HorizontalAlignment="Center"
                                                                       Margin="0,2,0,0" />
                                                        </StackPanel>
                                                        <Rectangle Width="80" 
                                                                   Height="3" 
                                                                   Fill="#4CAF50" 
                                                                   Margin="12,0"
                                                                   VerticalAlignment="Center"
                                                                   RadiusX="1.5"
                                                                   RadiusY="1.5" />
                                                        <StackPanel VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding RecommendedEndTimeDisplay}" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       HorizontalAlignment="Center" />
                                                            <TextBlock Text="End" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       FontSize="10"
                                                                       HorizontalAlignment="Center"
                                                                       Margin="0,2,0,0" />
                                                        </StackPanel>
                                                    </StackPanel>

                                                    <!-- Progress and Time Remaining -->
                                                    <StackPanel Margin="0,0,0,16">
                                                        <Grid Margin="0,0,0,8">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Text="{Binding TimeRemaining, StringFormat='â±ï¸ Time remaining: {0}'}" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       VerticalAlignment="Center" />
                                                            <TextBlock Grid.Column="1"
                                                                       Text="{Binding TodayProgress, StringFormat='Progress: {0:F0}%'}" 
                                                                       Style="{StaticResource CaptionText}"
                                                                       VerticalAlignment="Center" />
                                                        </Grid>
                                                        <ProgressBar Value="{Binding TodayProgress}"
                                                                      Style="{StaticResource ModernProgressBar}"
                                                                      Maximum="100"
                                                                      Height="10"
                                                                      Foreground="{StaticResource SuccessGreenBrush}" />
                                                    </StackPanel>

                                                    <!-- Notification Checkbox -->
                                                    <CheckBox Content="ðŸ”” Notify me 15 minutes before"
                                                              IsChecked="{Binding NotifyBeforeEnd}"
                                                              Margin="0"
                                                              Foreground="{StaticResource TextPrimaryBrush}" />
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Border>

                                    <!-- Today's Work Log Card -->
                                    <Border Style="{StaticResource CardStyle}">
                                        <StackPanel>
                                            <!-- Card Header -->
                                            <Grid Margin="0,0,0,16">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="ClipboardText" 
                                                                             Width="24" 
                                                                             Height="24"
                                                                             Foreground="{StaticResource PrimaryBlueBrush}"
                                                                             Margin="0,0,12,0"
                                                                             VerticalAlignment="Center" />
                                                    <TextBlock Text="Today's Work Log" 
                                                               Style="{StaticResource H2Text}" />
                                                </StackPanel>
                                                <Button Grid.Column="1"
                                                        Style="{StaticResource TextButtonStyle}"
                                                        Click="AddEntry_Click">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="Plus" 
                                                                                 Width="16" 
                                                                                 Height="16"
                                                                                 Margin="0,0,4,0" />
                                                        <TextBlock Text="Add" />
                                                    </StackPanel>
                                                </Button>
                                            </Grid>

                                            <!-- Work Entries List -->
                                            <ItemsControl ItemsSource="{Binding TodayEntries}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource EntryCardStyle}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Status Indicator -->
                                                                <Ellipse Grid.Column="0"
                                                                         Width="12"
                                                                         Height="12"
                                                                         Fill="{Binding TotalHours, Converter={StaticResource HoursToStatusColorConverter}}"
                                                                         Margin="0,0,12,0"
                                                                         VerticalAlignment="Center" />
                                                                
                                                                <StackPanel Grid.Column="1">
                                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                                                        <materialDesign:PackIcon Kind="ClockOutline" 
                                                                                                 Width="16" 
                                                                                                 Height="16"
                                                                                                 Foreground="{StaticResource TextSecondaryBrush}"
                                                                                                 VerticalAlignment="Center"
                                                                                                 Margin="0,0,6,0" />
                                                                        <TextBlock Text="{Binding TimeRangeDisplay}" 
                                                                                   Style="{StaticResource BodyText}"
                                                                                   FontWeight="Medium" />
                                                                    </StackPanel>
                                                                    <TextBlock Text="{Binding DurationDisplay, StringFormat='Duration: {0}'}" 
                                                                               Style="{StaticResource CaptionText}"
                                                                               Margin="0,0,0,4" />
                                                                    <TextBlock Text="{Binding Description}" 
                                                                               Style="{StaticResource CaptionText}"
                                                                               Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}"
                                                                               FontStyle="Italic" />
                                                                </StackPanel>
                                                                
                                                                <Button Grid.Column="2"
                                                                        Style="{StaticResource IconButtonStyle}"
                                                                        Width="32"
                                                                        Height="32"
                                                                        Click="MenuEntry_Click"
                                                                        Tag="{Binding}"
                                                                        ToolTip="More options">
                                                                    <materialDesign:PackIcon Kind="DotsVertical" 
                                                                                             Width="16" 
                                                                                             Height="16" />
                                                                </Button>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                            <!-- Empty State -->
                                            <StackPanel Visibility="{Binding TodayEntries.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=True}">
                                                <materialDesign:PackIcon Kind="Inbox" 
                                                                         Width="64" 
                                                                         Height="64"
                                                                         Foreground="{StaticResource TextDisabledBrush}"
                                                                         HorizontalAlignment="Center"
                                                                         Margin="0,32,0,16" />
                                                <TextBlock Text="No work logged today" 
                                                           Style="{StaticResource BodyText}"
                                                           HorizontalAlignment="Center"
                                                           Foreground="{StaticResource TextSecondaryBrush}" />
                                                <Button Content="Add First Entry"
                                                        Style="{StaticResource PrimaryButtonStyle}"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,16,0,0"
                                                        Click="AddEntry_Click" />
                                            </StackPanel>

                                            <!-- Today's Total -->
                                            <Border Background="{StaticResource PrimaryLightBrush}" 
                                                    CornerRadius="8" 
                                                    Padding="16" 
                                                    Margin="0,16,0,0">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel>
                                                        <TextBlock Text="Total Today" 
                                                                   Style="{StaticResource BodyText}"
                                                                   FontWeight="Medium" />
                                                        <TextBlock Text="{Binding TodayProgressDisplay}" 
                                                                   Style="{StaticResource BodyLargeText}"
                                                                   FontWeight="SemiBold" />
                                                    </StackPanel>
                                                    <ProgressBar Grid.Column="1"
                                                                 Value="{Binding TodayProgress}"
                                                                 Style="{StaticResource ModernProgressBar}"
                                                                 Maximum="100"
                                                                 Width="200"
                                                                 VerticalAlignment="Center" />
                                                </Grid>
                                            </Border>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>

                                <!-- RIGHT COLUMN -->
                                <StackPanel Grid.Column="2">

                                    <!-- Summary Dashboard Card -->
                                    <Border Style="{StaticResource CardStyle}">
                                        <StackPanel>
                                            <TextBlock Text="This Week" 
                                                       Style="{StaticResource H3Text}"
                                                       Margin="0,0,0,16" />
                                            
                                            <!-- Circular Progress -->
                                            <Grid HorizontalAlignment="Center" Margin="0,0,0,16">
                                                <Ellipse Style="{StaticResource CircularProgressTrack}" />
                                                <Ellipse Width="120" 
                                                         Height="120" 
                                                         Stroke="{StaticResource PrimaryBlueBrush}" 
                                                         StrokeThickness="12"
                                                         StrokeDashArray="{Binding WeeklyProgressPercent, Converter={StaticResource ProgressToDashArrayConverter}}"
                                                         Fill="Transparent"
                                                         RenderTransformOrigin="0.5,0.5">
                                                    <Ellipse.RenderTransform>
                                                        <RotateTransform Angle="-90" />
                                                    </Ellipse.RenderTransform>
                                                </Ellipse>
                                                <StackPanel VerticalAlignment="Center" 
                                                            HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding WeeklyHours, StringFormat='{}{0:F1}'}" 
                                                               Style="{StaticResource H1Text}"
                                                               HorizontalAlignment="Center" />
                                                    <TextBlock Text="hours" 
                                                               Style="{StaticResource CaptionText}"
                                                               HorizontalAlignment="Center" />
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Text="{Binding OvertimeSummary}" 
                                                       Style="{StaticResource BodyText}"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,0,0,16" />

                                            <!-- Weekly Sparkline (simplified) -->
                                            <Border Background="#F5F5F5" 
                                                    CornerRadius="4" 
                                                    Padding="12" 
                                                    Height="60"
                                                    Margin="0,0,0,16">
                                                <StackPanel Orientation="Horizontal" 
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center">
                                                    <TextBlock Text="M T W T F S S" 
                                                               Style="{StaticResource CaptionText}"
                                                               Margin="0,0,8,0" />
                                                    <Rectangle Width="4" Height="40" Fill="{StaticResource PrimaryBlueBrush}" Margin="1,0" />
                                                    <Rectangle Width="4" Height="40" Fill="{StaticResource PrimaryBlueBrush}" Margin="1,0" />
                                                    <Rectangle Width="4" Height="32" Fill="{StaticResource PrimaryBlueBrush}" Margin="1,0" />
                                                    <Rectangle Width="4" Height="36" Fill="{StaticResource PrimaryBlueBrush}" Margin="1,0" />
                                                    <Rectangle Width="4" Height="40" Fill="{StaticResource PrimaryBlueBrush}" Margin="1,0" />
                                                    <Rectangle Width="4" Height="8" Fill="{StaticResource BorderBrush}" Margin="1,0" />
                                                    <Rectangle Width="4" Height="8" Fill="{StaticResource BorderBrush}" Margin="1,0" />
                                                </StackPanel>
                                            </Border>

                                            <TextBlock Text="Target: 40h  |  Overtime: 0h" 
                                                       Style="{StaticResource CaptionText}"
                                                       HorizontalAlignment="Center" />
                                        </StackPanel>
                                    </Border>

                                    <!-- This Month Card -->
                                    <Border Style="{StaticResource CardStyle}">
                                        <StackPanel>
                                            <TextBlock Text="This Month" 
                                                       Style="{StaticResource H3Text}"
                                                       Margin="0,0,0,16" />
                                            
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                    <materialDesign:PackIcon Kind="ChartBar" 
                                                                             Width="20" 
                                                                             Height="20"
                                                                             Foreground="{StaticResource PrimaryBlueBrush}"
                                                                             Margin="0,0,8,0"
                                                                             VerticalAlignment="Center" />
                                                    <TextBlock Text="{Binding MonthlyHours, StringFormat='{}{0:F1} hours'}" 
                                                               Style="{StaticResource BodyLargeText}"
                                                               FontWeight="SemiBold" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                    <materialDesign:PackIcon Kind="TrendingUp" 
                                                                             Width="20" 
                                                                             Height="20"
                                                                             Foreground="{StaticResource SuccessGreenBrush}"
                                                                             Margin="0,0,8,0"
                                                                             VerticalAlignment="Center" />
                                                    <TextBlock Text="{Binding MonthlyHours, Converter={StaticResource AverageHoursConverter}}" 
                                                               Style="{StaticResource BodyText}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                    <materialDesign:PackIcon Kind="Calendar" 
                                                                             Width="20" 
                                                                             Height="20"
                                                                             Foreground="{StaticResource PrimaryBlueBrush}"
                                                                             Margin="0,0,8,0"
                                                                             VerticalAlignment="Center" />
                                                    <TextBlock Text="{Binding DaysWorkedThisMonth, StringFormat='Days worked: {0}/22'}" 
                                                               Style="{StaticResource BodyText}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="LightningBolt" 
                                                                             Width="20" 
                                                                             Height="20"
                                                                             Foreground="{StaticResource WarningOrangeBrush}"
                                                                             Margin="0,0,8,0"
                                                                             VerticalAlignment="Center" />
                                                    <TextBlock Text="Efficiency: 95%" 
                                                               Style="{StaticResource BodyText}" />
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Recent Activity Card -->
                                    <Border Style="{StaticResource CardStyle}">
                                        <StackPanel>
                                            <Grid Margin="0,0,0,16">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="Recent Activity" 
                                                           Style="{StaticResource H3Text}" />
                                                <Button Grid.Column="1"
                                                        Style="{StaticResource TextButtonStyle}"
                                                        Padding="8,4"
                                                        Command="{Binding RefreshHistoryCommand}">
                                                    <TextBlock Text="View All" />
                                                </Button>
                                            </Grid>

                                            <ItemsControl ItemsSource="{Binding RecentSummaries}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#F5F5F5" 
                                                                CornerRadius="8" 
                                                                Padding="12" 
                                                                Margin="0,0,0,8"
                                                                BorderThickness="1"
                                                                BorderBrush="{StaticResource BorderBrush}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition />
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Day of Week -->
                                                                <TextBlock Text="{Binding Date, Converter={StaticResource DateToDayOfWeekConverter}}" 
                                                                           Style="{StaticResource CaptionText}"
                                                                           FontWeight="SemiBold"
                                                                           VerticalAlignment="Center"
                                                                           Margin="0,0,8,0"
                                                                           Width="32" />
                                                                
                                                                <!-- Date -->
                                                                <TextBlock Grid.Column="1"
                                                                           Text="{Binding DateDisplay}" 
                                                                           Style="{StaticResource BodyText}"
                                                                           VerticalAlignment="Center" />
                                                                
                                                                <!-- Progress Bar -->
                                                                <ProgressBar Grid.Column="2"
                                                                             Value="{Binding TotalHours, Converter={StaticResource HoursToProgressWidthConverter}, ConverterParameter=8}"
                                                                             Maximum="100"
                                                                             Style="{StaticResource ModernProgressBar}"
                                                                             Width="100"
                                                                             Height="8"
                                                                             Margin="8,0"
                                                                             VerticalAlignment="Center"
                                                                             Foreground="{Binding TotalHours, Converter={StaticResource HoursToStatusColorConverter}}" />
                                                                
                                                                <!-- Hours and Status Icon -->
                                                                <StackPanel Grid.Column="3"
                                                                            Orientation="Horizontal"
                                                                            VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding TotalHoursDisplay}" 
                                                                               Style="{StaticResource BodyText}"
                                                                               FontWeight="SemiBold"
                                                                               Margin="0,0,8,0" />
                                                                    <Ellipse Width="16"
                                                                             Height="16"
                                                                             Fill="{Binding TotalHours, Converter={StaticResource HoursToStatusColorConverter}}"
                                                                             VerticalAlignment="Center">
                                                                        <Ellipse.Style>
                                                                            <Style TargetType="Ellipse">
                                                                                <Setter Property="ToolTip" Value="On target" />
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding TotalHours, Converter={StaticResource HoursToProgressWidthConverter}, ConverterParameter=8}" Value="{x:Static sys:Double.MaxValue}">
                                                                                        <Setter Property="ToolTip" Value="Excessive hours" />
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </Ellipse.Style>
                                                                    </Ellipse>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                            <!-- Empty State -->
                                            <StackPanel Visibility="{Binding RecentSummaries.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=True}">
                                                <materialDesign:PackIcon Kind="History" 
                                                                         Width="48" 
                                                                         Height="48"
                                                                         Foreground="{StaticResource TextDisabledBrush}"
                                                                         HorizontalAlignment="Center"
                                                                         Margin="0,24,0,8" />
                                                <TextBlock Text="No recent activity" 
                                                           Style="{StaticResource CaptionText}"
                                                           HorizontalAlignment="Center"
                                                           Foreground="{StaticResource TextSecondaryBrush}" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- ========================================== -->
                    <!-- HISTORY TAB -->
                    <!-- ========================================== -->
                    <TabItem>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- Filters -->
                            <Border Grid.Row="0" 
                                    Background="{StaticResource SurfaceBrush}"
                                    Padding="16"
                                    Margin="0,0,0,16"
                                    CornerRadius="8"
                                    BorderBrush="{StaticResource BorderBrush}"
                                    BorderThickness="1"
                                    Effect="{StaticResource ShadowSm}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <materialDesign:PackIcon Kind="Filter" 
                                                                 Width="20" 
                                                                 Height="20"
                                                                 Foreground="{StaticResource PrimaryBlueBrush}"
                                                                 VerticalAlignment="Center"
                                                                 Margin="0,0,12,0" />
                                        <ComboBox Width="150" 
                                                  Margin="0,0,12,0"
                                                  materialDesign:HintAssist.Hint="Time Period"
                                                  materialDesign:HintAssist.IsFloating="True">
                                            <ComboBoxItem Content="ðŸ“… This Month" IsSelected="True" />
                                            <ComboBoxItem Content="ðŸ“… Last Month" />
                                            <ComboBoxItem Content="ðŸ“… This Year" />
                                            <ComboBoxItem Content="ðŸ“… All Time" />
                                        </ComboBox>
                                        <ComboBox Width="120" 
                                                  Margin="0,0,12,0"
                                                  materialDesign:HintAssist.Hint="Type"
                                                  materialDesign:HintAssist.IsFloating="True">
                                            <ComboBoxItem Content="ðŸ·ï¸ All" IsSelected="True" />
                                            <ComboBoxItem Content="ðŸ’¼ Work" />
                                            <ComboBoxItem Content="â˜• Break" />
                                        </ComboBox>
                                        <TextBox Width="200" 
                                                 Text="{Binding HistoryFilter, UpdateSourceTrigger=PropertyChanged}"
                                                 materialDesign:HintAssist.Hint="ðŸ” Search history"
                                                 materialDesign:HintAssist.IsFloating="True"
                                                 Margin="0,0,12,0" />
                                    </StackPanel>
                                    <Button Grid.Column="1"
                                            Style="{StaticResource PrimaryButtonStyle}"
                                            Command="{Binding ExportCommand}"
                                            Padding="16,8"
                                            ToolTip="Export to CSV">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="FileExport" 
                                                                     Width="16" 
                                                                     Height="16"
                                                                     Margin="0,0,8,0"
                                                                     VerticalAlignment="Center" />
                                            <TextBlock Text="Export" />
                                        </StackPanel>
                                    </Button>
                                </Grid>
                            </Border>

                            <!-- History DataGrid -->
                            <DataGrid Grid.Row="1"
                                      ItemsSource="{Binding FilteredHistory}"
                                      Style="{StaticResource ModernDataGrid}"
                                      CanUserSortColumns="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Date" 
                                                        Binding="{Binding Date, StringFormat='{}{0:ddd, MMM d}'}" 
                                                        Width="120" />
                                    <DataGridTextColumn Header="Start" 
                                                        Binding="{Binding StartTime, StringFormat='{}{0:t}'}" 
                                                        Width="100" />
                                    <DataGridTextColumn Header="End" 
                                                        Binding="{Binding ActualEndTime, StringFormat='{}{0:t}'}" 
                                                        Width="100" />
                                    <DataGridTextColumn Header="Break" 
                                                        Binding="{Binding TotalHours, Converter={StaticResource BreakDurationConverter}}" 
                                                        Width="80" />
                                    <DataGridTextColumn Header="Total" 
                                                        Binding="{Binding TotalHours, StringFormat='{}{0:F1}h'}" 
                                                        Width="80" />
                                    <DataGridTemplateColumn Header="Status" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <Ellipse Width="12"
                                                             Height="12"
                                                             Fill="{Binding TotalHours, Converter={StaticResource HoursToStatusColorConverter}}"
                                                             Margin="0,0,8,0"
                                                             VerticalAlignment="Center" />
                                                    <TextBlock Text="{Binding TotalHours, Converter={StaticResource HoursToProgressWidthConverter}, ConverterParameter=8, StringFormat='{}{0:F0}%'}" 
                                                               Style="{StaticResource CaptionText}"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="" Width="60">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Style="{StaticResource IconButtonStyle}"
                                                        Width="32"
                                                        Height="32"
                                                        Click="EditEntry_Click"
                                                        Tag="{Binding}">
                                                    <materialDesign:PackIcon Kind="DotsVertical" 
                                                                             Width="16" 
                                                                             Height="16" />
                                                </Button>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>

        <!-- Dialog Host Overlay -->
        <materialDesign:DialogHost IsOpen="{Binding IsSettingsOpen}"
                                 Background="{StaticResource BackgroundBrush}"
                                 Identifier="MainDialogHost"
                                 materialDesign:DialogHost.DialogClosing="DialogHost_DialogClosing"
                                 materialDesign:DialogHost.DialogOpened="DialogHost_DialogOpened">
            <materialDesign:DialogHost.DialogContent>
                <views:SettingsDialog x:Name="SettingsDialogControl" 
                                     DataContext="{Binding DataContext.Settings, RelativeSource={RelativeSource AncestorType=Window}}" />
            </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
    </Grid>
</Window>
